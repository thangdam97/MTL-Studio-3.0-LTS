
import json
import re
import os

chapter_content = """
# Chapter 1: The Blonde and the Brunette's Charm Offensive

# Chapter 1

[ILLUSTRATION: illust-001.jpg]

"I feel like I'm floating..."

After speaking with Yo on the roof, Marin returned home, her face flushed red as if she were delirious with a fever.

Marin was aware that she had said things so bold, she couldn't believe they'd come from her past self.

"That's strange. I didn't mean to say any of that..."

The truth was, when Marin had headed to that rooftop, she had intended to end her relationship with Yo.

It was true that she and Haruki had talked and come to an understanding, but seeing Kasumi in such a good mood in class led her to believe that things between Yo and Kasumi had been resolved as well.

She knew that her presence would only be an unnecessary source of conflict, so for Yo's sake, Marin had planned to step aside.

In the first place, Marin had expected Yo to be the one to tell her their relationship was over. Her scenario was that she would simply nod and that would be the end of it.

However, the moment she heard that being with her would also be for Yo's benefit, a spark of hope was born within her.

And when Yo actually told her he was ending their relationship, her chest felt incredibly tight, and before she knew it, she was pinching the sleeve of his shirt.

An unconscious act.

Which meant, surely, that it was what she truly felt.

"Do I... like Hazakura-kun...?"

Marin flopped onto her bed and spoke the words as if questioning herself.

And then—

"Gaaaaah!"

Realizing she had just said something unbelievably embarrassing, she started thrashing around on her bed.

Marin continued to writhe in embarrassment for a good five minutes before she finally calmed down and began to think about Kasumi.

"Come to think of it, I only heard the last part... but Nemoto-san was pretty possessive of Hazakura-kun, wasn't she...? Like being with him all day on his days off... If their relationship is fixed, does that mean from now on, they'll be..."

The thought made Marin's chest tighten instantly.

It was especially painful, almost enough to make her cry, when she pictured the two of them—Yo giving Kasumi a lap pillow, or holding her and stroking her head.

There was no guarantee the two of them would do those things now.

But from what she had overheard of Yo's stories about the past, there was no doubt they had done such things before.

"..."

Her chest aching, Marin reflexively picked up her phone to send Yo a message.

But she didn't know what to send and ended up frozen, just staring at the screen.

"What exactly is my position to Hazakura-kun...?"

Yo had told Marin that she could use him however she liked.

That meant she was free to message or call him, and recently, with the exception of yesterday, Marin had been calling Yo every night.

But in the end, Marin didn't know how Yo truly felt about it.

It would be fine if he saw it in a positive light, but if he saw it negatively, that would be a huge problem.

Only now did Marin become scared to contact Yo.

"...Ah, come to think of it..."

As Marin agonized over whether she should message Yo, she remembered something and decided to change the recipient.

*Is it all right if I ask for some advice?*

Just the other day, someone had told her, *'If anything comes up, just let me know,'* and given her their contact info. Marin decided to send a message to that person.

A reply came back almost immediately.

*Feel free to ask me anything, nya.*

The message was written in "cat-speak," which Marin found absolutely adorable.

Marin was happy that they had replied so quickly, even though they were so popular and must be very busy.

*Um, it's a little hard to talk about, but...*

*It's about Yo-kun, right? Wanna ask about his relationship with Kasumi-chan? Or do you wanna know what his type is, nya?*

Seeing the message that came back right after she'd sent hers, Marin involuntarily gasped.

She'd heard rumors online, but she was truly surprised by how perceptive this person was.

At the same time, a blush rushed through her entire body at the feeling of having her own thoughts seen through so clearly.

*W-Well, you're right, but just to be sure, let me confirm... Nagisa-chan, you and Hazakura-kun aren't dating, are you... ?*

With blood rushing to her head from embarrassment, Marin ended up asking about something that had been bothering her since yesterday.

"Ah! What did I just send...?! No, no! Don't send it!"

Marin frantically tried to cancel it, but the message was sent without mercy.

Once it was sent, there was nothing she could do.

Even if she deleted the message on her end, it wouldn't disappear for the recipient—Nagisa.

*Nyahaha, no way, no way! I don't think Yo-kun sees me like that!*

Marin had been bracing herself, wondering what she would do if she'd offended her, but the person on the other end sent a cheerful reply.

Seeing the text, Marin felt a double sense of relief.

*W-Well then, I'd be grateful if you could give me some advice... Ah, and also, if you could keep this a secret from Hazakura-kun...*

*Okay, okay. Let's talk on the phone, nya.*

*Is that really okay... ?*

*Yup. But I'll tell you one thing: your opponent is super tough, so you'd better be prepared, nya~*

Marin wondered if "opponent" referred to Kasumi or to Yo, but for the time being, she called the phone number she'd been given.

◆

"—You're late."

After his discussion with Marin, Yo arrived home to find Kasumi waiting in front of the door in casual clothes, standing there like a temple guardian.

Seeing Kasumi in an unusually revealing outfit, Yo opened his mouth, not knowing where to look.

"My bad."

Yo didn't say what he had been doing at school, just offered a short apology.

Then he walked past Kasumi and started to unlock the door.

"Were you trying to make me wait on purpose?"

"That wasn't my intention."

Yo shook his head in response to Kasumi, who was looking up at him resentfully.

Today was the day he had promised to meet with Kasumi.

From Kasumi's perspective, not knowing what Yo had been up to, she might have thought he was deliberately messing with her.

However—

"It's open. Get in."

"..."

When Yo opened the door, Kasumi's eyes sparkled for a moment, then she adopted a demure attitude and tugged on the sleeve of Yo's shirt.

Apparently, she had no intention of going in first.

As they stood there, Nya-san, who was always eagerly awaiting Yo's return, appeared in the entryway.

Then, the cat opened its mouth and let out an adorable meow.

And then—

"Nya-san!"

Her earlier meekness was nowhere to be seen.

Kasumi's excitement shot up, and she let out a high-pitched voice she would never use at school as she pounced on Nya-san.

"Nya!"

"Nya-san, it's been so long! You're as cute as ever!"

"Nya nya."

As Kasumi nuzzled her cheek against the cat, Nya-san, far from being annoyed, seemed to happily return the gesture.

It seemed Nya-san was also happy about their reunion after so long.

Watching them, Yo thought to himself:

*The girls around me really do have a personality change whenever there's a cat around...*

Kasumi, seemingly oblivious to Yo's gaze, faced Nya-san with a sharp expression.

And then—she pointed a finger decisively at the cat.

"Nya-san, daifuku!"

"Nya!"

"Nya-san, sweet-talk pose!"

"Nya!"

"Amazing, amazing, you still remember! Good boy!"

"Nyaa~"

Since Nya-san struck the poses perfectly upon command, Kasumi happily stroked the cat's head.

In fact, it was Kasumi who had taught Nya-san these tricks.

"I brought you some treats, too."

"Nya~1"

When Kasumi took out a tube-shaped cat treat, Nya-san began to eat it happily.

Watching the scene, Yo superimposed it over a memory from two years ago.

And, strangely, a warm feeling washed over him.

"Why don't you just play with Nya-san for the rest of the time?"

"What, are you trying to break our promise?"

Yo had said it with good intentions, watching Kasumi and the cat, but Kasumi, taking it the wrong way, glared up at Yo with a terrifying look in her eyes.

Because of that, Nya-san hissed, fled from Kasumi's hands, and hid behind Yo.

"Hey! It's your fault Nya-san ran away!"

"No, that was your fault..."

Annoyed by Kasumi's complaints, Yo picked up the poor, frightened Nya-san.

Then, he gently stroked its head.

In response, Nya-san narrowed its eyes comfortably and snuggled up to him.

"..."

Kasumi watched Yo and Nya-san with an envious look, then started tugging at the sleeve of Yo's shirt.

"What is it?"

"Hurry up. Your room."

To Kasumi, who said this with an upward glance, as if she were begging for something, Yo couldn't help but swallow.

Then, he handed Nya-san over to Kasumi.

"For now, I'm going to get changed."

Thinking he couldn't let himself get swept up in the mood, Yo said this and put some distance between himself and Kasumi.

And then—

"Meanie..."

Kasumi immediately started to pout, and seeing her overlap with her old self, Yo felt like clutching his head.

*This is the pattern where we just slide right back to how things used to be...*

—he thought to himself.

◆

"—Sorry to keep you waiting."

After changing into his regular clothes, Yo called out to Kasumi, who was playing with Nya-san in the living room.

Kasumi seemed to be thoroughly enjoying her time with the cat, a goofy smile on her face as she poked at Nya-san's paw pads.

He decided to ignore the lovey-dovey expression on his childhood friend's face as she doted on Nya-san and turned on his heel to head back to his room.

Now that Yo had come for her, Kasumi seemed somewhat pleased as she followed behind him.

Nya-san looked sleepy, so she'd left the cat to rest on a fluffy cushion.

And, upon entering Yo's room—

"—Yo."

"Hm?... What are you doing?"

Her voice made him turn around, and seeing Kasumi reaching for her black stockings, Yo asked with a puzzled expression.

However, Kasumi didn't answer his question and instead began to smoothly peel off her black stockings.

The black fabric receded, revealing flawless, beautiful white skin.

Yo couldn't tear his eyes away from the sight and ended up watching until Kasumi had finished taking them off.

Then, once she was done, Kasumi shot him a sly grin.

"You like this sort of thing, don't you?"

"Could you stop treating me like a pervert?"

"But your eyes were glued to them."

Kasumi said this as she drew closer, looking up at Yo's face from point-blank range with a smirk.

In response, Yo turned his face away and spoke.

"You're imagining things."

Seeing this, Kasumi inwardly gloated.

Then, she pressed her advantage.

"Yo, sit on the bed."

"Huh? Why?"

"I'm going to sit on your lap."

"—!"

"That's all right, isn't it? You shouldn't have the right to refuse, after all. I expect you to keep your promise, you know?"

The promise Kasumi and Yo had made—was that one day a week, Kasumi would be allowed in Yo's room to do as she pleased.

But, regardless of how things were in the past, the two had been fighting for about a year and a half.

Yo had expected Kasumi to close the distance little by little, so her sudden words took him by surprise.

"Have you no shame?"

"You're the one who said you wanted to let bygones be bygones, right? I'm just respecting your wishes."

"Still, though..."

"If you don't keep your promise, I'll get angry, you know?"

What would she do if she got angry—Yo wondered, but he already knew well enough that provoking Kasumi was a bad idea.

So, even though he knew it would only make the situation more and more complicated, Yo sat down on the bed.

At that, Kasumi looked overjoyed as she sat down on Yo's lap.

Then, she curled up slightly and rested the side of her head against Yo's chest with a soft *thump*.

Anyone could see she was in full-on clingy mode.

"Your personality changes way too much..."

"I've always been like this, haven't I?"

It was true, just as Kasumi said. Until two years ago, whenever they were alone, Kasumi would instantly become clingy.

But after being apart for so long, and given Kasumi's resentful attitude until they made up, he was at a loss for what to do when she suddenly became so affectionate.

Besides, the result of continuing to indulge this clingy Kasumi was a Kasumi who was severely dependent on him.

Yo was deeply conflicted about whether he should allow her to be so affectionate.

And he was also at a loss for where to look.

Currently, Kasumi was wearing a sleeveless top that exposed her shoulders and armpits, something she'd probably never normally wear, along with a miniskirt that barely covered her lower half.

[ILLUSTRATION: illust-006.jpg]

In short, she was showing a lot of skin, so no matter where he looked, he felt awkward.

As Yo struggled with where to direct his gaze, Kasumi spoke with a smug look on her face.

"What's wrong? You seem to be troubled by something."

"You know exactly what you're doing, don't you?"

"Oh, I wonder what you could possibly mean?"

Faced with a smirking Kasumi, Yo was overcome with the urge to pinch her cheek.

But doing so would only make Kasumi angry, so he grit his teeth and spoke.

"You've gotten quite fond of showing skin."

"Don't get the wrong idea. You're the only one I'd show this side of myself to."

Should he be happy about that or not?

In any case, she had been standing in front of his house in this outfit, so the neighbors must have seen her, but Kasumi didn't seem to care.

"Who's supposed to be happy about that...?"

"Heeh? But you like bare legs, don't you?"

Kasumi's eyes were provocative as she began to stroke her own beautiful white legs.

Yo's gaze was involuntarily drawn to the movement, but he quickly admonished himself.

"I'm not that kind of pervert."

"You're a teenager. You should just be honest with your desires."

"Only an idiot would unleash their desires just because someone told them to."

Yo retorted, but since his eyes kept darting to Kasumi's thighs, his words lacked any conviction.

"You act like you're not interested in girls, but you're actually a closet pervert, aren't you, Yo?"

"Don't be ridiculous. I'm putting you down."

"If you do that, I'll go crying to your mom that you were bullying me."

"..."

The one thing in this world that Yo was truly weak against.

It was, to be perfectly honest, his own mother.

The reason he reluctantly went to school every day, even though he thought it was pointless, was because he couldn't defy his mother.

Kasumi, knowing this, had known since they were little that she could get most of her demands met by using Yo's mother as a shield.

The reason she hadn't used that power when they were fighting was likely because she had instinctively sensed that doing so would make it truly impossible to reconcile with Yo.

But now that they had made up, there was no doubt she would start using it for all it was worth on most things.

"You've really been devious since we were kids..."

"It's a problem that would be solved if you'd just spoil me without complaining."

"And the fact you can say that so brazenly is honestly impressive."

In the end, Yo gave up on putting Kasumi down.

At that, Kasumi looked at him with expectant eyes.

"Here, pat my head."

Apparently, she thought she was going to be spoiled.

With no other choice, Yo reached out his hand to Kasumi's head and began to gently stroke it.

Satisfied with that, Kasumi once again rested her head against Yo's chest and nuzzled him.

◆

"Ehehe, Yooo~"

How many hours had passed since then?

As if to make up for all the lost time, Kasumi had been tirelessly nuzzling against Yo.

Sometimes she would nuzzle his neck, and it was all Yo could do to endure the ticklish sensation.

*She looks like she's grown up, but on the inside, she's still a kid...*

Though Kasumi acted like an adult, at her core, she was very much a child.

Ever since they were young, Kasumi had adopted a standoffish attitude toward others, just like Yo.

But that wasn't because she was cold at heart; she was actually just copying Yo.

Yo had grown to dislike the people who were jealous of his relationship with Kasumi or teased them about it, and had started to reject them.

In turn, he had begun to dote on Kasumi, who had been with him since they were little.

Because of this, Kasumi came to believe she was special to Yo, and thought that by not engaging with anyone else, she could create a space just for the two of them.

That was why she had started pushing others away, but at her core, she was a clingy person.

So whenever she was alone with Yo, she would immediately start acting affectionate like this.

And since Yo continued to spoil a Kasumi like that, forgiving most of her whims and immediately stepping in to solve any problems she had, her core had remained that of a child.

Faced with his childhood friend who hadn't changed since they were young, Yo was reminded once again of his own culpability.

However—

"Yo, your hand stopped. Pat me properly."

When she acted so clingy, he felt bad pushing her away.

So, in response to Kasumi's request with her upward glance, Yo once again began to gently stroke her head.

That alone was enough to make Kasumi go all lovey-dovey.

*If the guys at school saw this, they'd all be completely shocked...*

Kasumi, who was acting so affectionate, was a world away from her usual cool demeanor.

The students at school, who only knew the cool and aloof Kasumi, would probably suspect she was a different person if they saw this sight.

That's how different her personality was now compared to at school.

"Nyaa~"

As he was spoiling Kasumi, Nya-san, who should have been sleeping in the living room, came into Yo's room.

It seemed the cat had come looking for Yo and Kasumi.

Upon finding the two of them, Nya-san jumped onto Kasumi's lap.

Then, it meowed, appealing to Yo to be petted as well.

However, Yo's hands were currently occupied.

His left hand was wrapped around Kasumi's back to her stomach, holding her steady.

His right hand, meanwhile, was stroking Kasumi's head, and if he stopped, Kasumi would immediately start to pout.

Therefore, Yo had no hands left to pet Nya-san.
"

metadata_en_content = {
  "title_en": "Everyone Thinks I'm Dating the Losing Heroine, Kicking Off a Rom-Com War With My Childhood Friend!, Vol. 2",
  "author_en": "Nekokuro",
  "illustrator_en": "",
  "publisher_en": "Overlap",
  "chapters": [
    {
      "id": "chapter_01",
      "title_en": "A Blonde's Advance, a Brunette's Bid"
    },
    {
      "id": "chapter_06",
      "title_en": "The Brunette's Bargain"
    },
    {
      "id": "chapter_11",
      "title_en": "Oil and Water, Blonde and Black"
    },
    {
      "id": "chapter_15",
      "title_en": "The Blonde's Getaway Plan"
    },
    {
      "id": "chapter_18",
      "title_en": "A Declaration of War"
    }
  ],
  "character_names": {
    "葉桜陽《はざくらよう》": "Hazakura Yo",
    "根本《ねもと》": "Nemoto",
    "秋実真凛《あきみまりん》": "Akimi Marin",
    "木下晴喜《きのしたはるき》": "Kinoshita Haruki",
    "佳純《かすみ》": "Kasumi",
    "秋実《あきみ》": "Akimi",
    "真凛《まりん》": "Marin",
    "葉桜《はざくら》": "Hazakura",
    "晴喜《はるき》": "Haruki",
    "木下《きのした》": "Kinoshita",
    "根本佳純《ねもとかすみ》": "Nemoto Kasumi",
    "凪沙《なぎさ》": "Nagisa",
    "神風《かみかぜ》": "Kamikaze",
    "葛井聡《くずいさとし》": "Kuzui Satoshi",
    "葛井《くずい》": "Kuzui",
    "真凛": "Marin",
    "晴喜": "Haruki",
    "佳純": "Kasumi",
    "葉桜": "Hazakura",
    "根本": "Nemoto",
    "凪沙": "Nagisa",
    "喧嘩": "Kenka",
    "真似": "Mane",
    "云々": "Unnun",
    "木下": "Kinoshita",
    "誹謗中傷": "Hibochiyushiyo",
    "秋実": "Akimi",
    "甲斐": "Kai",
    "奴等": "Yatsura",
    "生贄": "Ikenie",
    "大袈裟": "Ogesa",
    "他人事": "Hitogoto",
    "咄嗟": "Tossa",
    "仔猫": "Koneko",
    "言質": "Genchi",
    "性質": "Tachi",
    "不憫": "Fubin",
    "神庭": "Kanba",
    "鵜吞": "Uno",
    "名瀑": "Meibaku",
    "贅沢": "Zeitaku",
    "明太子": "Mentaiko",
    "火傷": "Yakedo",
    "微笑": "Hohoe",
    "醬油出汁": "Shiyoyudashi",
    "純陽": "Jiyunyo",
    "観音寺": "Kanonji",
    "語彙": "Goi"
  }
}

# --- Character Name Validation ---
canonical_english_names = set(metadata_en_content.get("character_names", {}).values())

# Sorted list for regex matching (longer names first)
sorted_canonical_english_names = sorted(list(canonical_english_names), key=len, reverse=True)

hepburb_romanization_warnings = []
name_order_errors = []
unrecognized_names_in_text = []

# Hepburn Romanization warnings (check canonical names themselves)
romanization_patterns = ["uu", "ou", "ei", "ii"]
for name in canonical_english_names:
    for pattern in romanization_patterns:
        # Simplified check for demonstration. In a real scenario, "ei", "ou" might be allowed in some contexts.
        if pattern in name.lower() and pattern not in ["ei", "ou"]:
            hepburb_romanization_warnings.append(f"Canonical name '{name}' might have non-natural Hepburn romanization (contains '{pattern}')")

# Unrecognized names in text
words_in_chapter = re.findall(r'\b[A-Za-z]+\b', chapter_content)

canonical_english_names_lower = {name.lower() for name in canonical_english_names}

for word in words_in_chapter:
    if word.lower() not in canonical_english_names_lower:
        is_part_of_canonical = False
        for c_name in canonical_english_names:
            if word in c_name.split() or word.capitalize() in c_name.split():
                is_part_of_canonical = True
                break
        
        if not is_part_of_canonical and len(word) > 2 and word.lower() not in ["the", "and", "but", "she", "he", "was", "her", "his", "had", "for", "with", "from", "that", "this", "like", "you", "not", "him", "her", "they", "them", "their", "their", "were", "what", "how", "when", "why", "who", "whom", "whose", "which", "where", "while", "would", "could", "should", "don't", "can't", "won't", "isn't", "aren't", "hasn't", "haven't", "hadn't", "wasn't", "weren't", "i'm", "you're", "he's", "she's", "it's", "we're", "they're", "i've", "you've", "we've", "they've", "i'll", "you'll", "he'll", "she'll", "it'll", "we'll", "they'll"]:
            unrecognized_names_in_text.append(word)

unrecognized_names_in_text = list(set(unrecognized_names_in_text))

# Name Order Violations
for canonical_full_name in canonical_english_names:
    if ' ' in canonical_full_name:
        parts = canonical_full_name.split(' ')
        if len(parts) == 2:
            surname, firstname = parts[0], parts[1]
            reversed_name_in_text = f"{firstname} {surname}"
            if re.search(r'\b' + re.escape(reversed_name_in_text) + r'\b', chapter_content):
                name_order_errors.append(f"Name order error: '{reversed_name_in_text}' found in text, but canonical is '{canonical_full_name}' (Surname-first).")

print("\n--- Terms and Character Names Audit ---")

if hepburb_romanization_warnings:
    print("\n### Hepburn Romanization Warnings:")
    for warning in hepburb_romanization_warnings:
        print(f"- {warning}")
else:
    print("\nNo Hepburn Romanization warnings.")

if name_order_errors:
    print("\n### Name Order Errors (CRITICAL):")
    for error in name_order_errors:
        print(f"- {error}")
else:
    print("\nNo Name Order errors detected.")

if unrecognized_names_in_text:
    print("\n### Unrecognized Names in Text (Potential Issues):")
    for name in unrecognized_names_in_text:
        print(f"- '{name}' found in text, but not in canonical list. Consider adding or correcting.")
else:
    print("\nNo unrecognized names found in text.")

print("\nTerm Consistency check skipped due to lack of explicit glossary terms.")

